# Data Manipulation

About two hours in this exam will be spent just on data manipulation.  A common complaint from exam takers who are new to R programming is that this takes too long.  Putting in extra practice in this area is garanteed to give you a better score because it will free up time that you can use elsewhere.

Each time that you want to "do something" to the data, most of the time there is a function that will do this.  

### Look at the data

The `head()` or `glimpse()` functions both suffice.

```{r message = F}
library(tidyverse)
iris %>% head()
```

```{r}
iris %>% glimpse()
```

### Look at summary statistics

The `summary()` function is best.

```{r}
iris %>% summary()
```

### Find the dimensions of the data

```{r}
iris %>% dim()
```

### Queries 

Queries are very similar to SQL.  They begin with a "SELECT", use "GROUP BY" to aggregate, and have a "WHERE" to remove records.  Unlike SQL, the ordering of these does not matter.  "SELECT" can come after a "WHERE".

dplyr to SQL translation**

```
select() -> SELECT
mutate() -> user-defined columns
summarize() -> aggregated columns
left_join() -> LEFT JOIN
filter() -> WHERE
group_by() -> GROUP BY
filter() -> HAVING
arrange() -> ORDER BY

```

```{r}
iris %>% select(Sepal.Length, Sepal.Width) %>% head()
```

```{r}
iris %>% 
  select(Sepal.Length, Species) %>% 
  group_by(Species) %>% 
  summarise(TotalLength = sum(Sepal.Length))
```

Just like in SQL, many different aggregate functions can be used such as "SUM", "MEAN", "MIN", "MAX", and so forth.

```{r}
iris %>% 
  select(Sepal.Length, Species) %>% 
  group_by(Species) %>% 
  summarise(TotalLength = sum(Sepal.Length),
            MaxLength = max(Sepal.Length),
            MeanLength = mean(Sepal.Length))
```

## Data Types

Each object in R has a different type.  

- numeric 
- character 
- factors
- booleans

As well as classes

- matrix
- data frame
- tibble (just another name for a data frame)
- list (most important)

## Exercises

Get the DWSimpson actuarial salary data and run queries on it.

1.  How many FSAs are represented?

2.  What is the average salary for a Life/Health Actuarial Analyst with 3-5 exams passed?

3.  What is the average difference in salary between an ASA and an ACAS?

4.  Create a new column, called `social_life`, which is equal to `n_exams`/`years_experience`.  What is the median `social_life` by industry?

5.  Create a new column using `case_when` which is equal to 0 when `n_exams` is less than 3 and `n_exams`^2 otherwise.




