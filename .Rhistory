summarise(accuracy = mean(pred_zero_one == target))
confusionMatrix(test$pred_zero_one,factor(test$target))$table
confusionMatrix(test$pred_zero_one,factor(test$target))
rf <- randomForest(charges ~ age + bmi, data = health_insurance, ntree = 500)
library(randomForest)
tree <- rpart(charges ~ age + bmi, data = health_insurance)
library(rpart)
library(randomForest)
tree <- rpart(charges ~ age + bmi, data = health_insurance)
df <- health_insurance %>% mutate(
prediction = predict(tree, health_insurance))
p1 <- df %>%
ggplot(aes(bmi, age, color = prediction)) +
geom_point() +
scale_color_viridis_c() +
theme_bw() +
labs(title ="Decision Tree") +
theme(legend.position = "none")
rf <- randomForest(charges ~ age + bmi, data = health_insurance, ntree = 50)
df <- health_insurance %>% mutate(
prediction = predict(rf, health_insurance))
p2 <- df %>%
ggplot(aes(bmi, age, color = prediction)) +
geom_point() +
scale_color_viridis_c() +
theme_bw() +
labs(title ="Random Forest") +
theme(legend.position = "none")
library(ggpubr)
ggarrange(p1,p2)
rf <- randomForest(charges ~ age + bmi, data = health_insurance, ntree = 500)
plot(rf)
getTree(rf, k = 1)
getTree(rf, k = 1) %>% dim()
tree1 <- getTree(rf, k = 1)
str(tree1)
tree1 <- getTree(rf, k = 1) %>% as_tibble()
tree1
tree1 %>% nrow()
tree1
tree1 <- getTree(rf, k = 1)
rpart.plot(tree1)
library(rpart.plot)
tree1 <- getTree(rf, k = 1)
rpart.plot(tree1)
getTree
?getTree
tree1 <- getTree(rf, k = 1) %>% as_tibble()
tree1
tree1 %>% count(status)
varImp(rf)
importance(rf)
rf <- randomForest(charges ~ ., data = health_insurance, ntree = 500)
sum(health_insurance)
health_insurance
health_insurance %>% count(region)
head(health_insurance)
health_insurance %>% count(region)
rf_data <- health_insurance %>%
mutate(sex = ifelse(sex == "male", 1, 0),
smoker = ifelse(smoker == "yes", 1, 0),
region_ne = ifelse(region == "northeast", 1,0),
region_nw = ifelse(region == "northwest", 1,0),
region_se = ifelse(region == "southeast", 1,0),
region_sw = ifelse(region == "southwest", 1,0))
rf_data %>% head()
rf_data <- health_insurance %>%
mutate(sex = ifelse(sex == "male", 1, 0),
smoker = ifelse(smoker == "yes", 1, 0),
region_ne = ifelse(region == "northeast", 1,0),
region_nw = ifelse(region == "northwest", 1,0),
region_se = ifelse(region == "southeast", 1,0),
region_sw = ifelse(region == "southwest", 1,0)) %>%
select(-region)
rf_data %>% glimpse(50)
set.seed(42)
index <- createDataPartition(y = rf_data$charges, p = 0.8, list = F)
train <- df %>% slice(index)
test <- df %>% slice(-index)
set.seed(42)
index <- createDataPartition(y = rf_data$charges, p = 0.8, list = F)
train <- rf_data %>% slice(index)
test <- rf_data %>% slice(-index)
rf <- randomForest(charges ~ ., data = train, ntree = 500)
plot(rf)
importance(rf)
plot(importance(rf))
importance(rf)
importance_result <- importance(rf)
result <- importance(rf)
tibble(names(result))
tibble(variable = names(result))
names(result)
result <- importance(rf)
names(result)
rownames(result)
tibble(variable = rownames(result),
importance = result)
result
tibble(variable = rownames(result),
importance = as.numeric(result))
tibble(variable = rownames(result),
importance = as.numeric(result)) %>%
ggplot(aes(variable, importance))
tibble(variable = rownames(result),
importance = as.numeric(result)) %>%
ggplot(aes(variable, importance)) +
geom_bar(stat = "identity")
tibble(variable = rownames(result),
importance = as.numeric(result)) %>%
ggplot(aes(variable, importance)) +
geom_bar(stat = "identity") +
coord_flip()
tibble(variable = rownames(result),
importance = as.numeric(result)) %>%
mutate(variable = fct_reorder(variable, importance)) %>%
ggplot(aes(variable, importance)) +
geom_bar(stat = "identity") +
coord_flip()
tibble(variable = rownames(result),
importance = as.numeric(result)) %>%
mutate(variable = fct_reorder(variable, importance)) %>%
ggplot(aes(variable, importance)) +
geom_bar(stat = "identity") +
coord_flip() +
theme_bw()
?importance
varImpPlot(rf)
?randomForest::importance
varImpPlot(rf, type = 1)
?varImpPlot
varImpPlot(x = rf, type = 1)
varImpPlot(rf)
varImpPlot(rf, scale = T)
varImpPlot(rf, scale = F)
varImpPlot(rf, scale = F, type = "1")
varImpPlot(rf, scale = F, type = 1)
?importance
varImpPlot(x = rf, type = 1)
varImpPlot(x = rf)
varImpPlot(x = rf)
partial(rf)
library(pdp)
pdp::partial(rf)
pdp::partial(rf, pred.var = "bmi")
pdp::partial(rf, pred.var = "bmi") %>% autoplot()
pred <- predict(rf, test)
pred
pred <- predict(rf, test)
get_rmsle <- function(y, y_hat){
sqrt(mean((log(y) - log(y_hat))^2))
}
get_rmsle(test$charges, pred)
get_rmsle(test$charges, mean(train$charges))
tibble(x1 = c(1,1,2,2), x = c(3,4,5,6)) %>%
mutate(f = 2*x1 + 3*x2)
tibble(x1 = c(1,1,2,2), x2 = c(3,4,5,6)) %>%
mutate(f = 2*x1 + 3*x2)
df <- tibble(x1 = c(1,1,2,2), x2 = c(3,4,5,6)) %>%
mutate(f = 2*x1 + 3*x2)
df
df %>% group_by(x1) %>% summarise(f = mean(x1))
df %>% group_by(x1) %>% summarise(f = mean(f))
library(pdp)
bmi <- pdp::partial(rf, pred.var = "bmi") %>% autoplot()
age <- pdp::partial(rf, pred.var = "age") %>% autoplot()
bmi
library(pdp)
bmi <- pdp::partial(rf, pred.var = "bmi") %>% autoplot() + theme_bw()
age <- pdp::partial(rf, pred.var = "age") %>% autoplot() + theme_bw()
ggarrange(bmi, age)
?ggarrange
ggarrange(bmi, age)
pdp::partial(rf, pred.var = c("age", "bmi")) %>% autoplot() + theme_bw()
?gbm
library(gbm)
?gbm
library(ExamPAData)
library(tidyverse)
library(rpart)
library(rpart.plot)
tree <- rpart(charges ~ smoker + bmi, data = health_insurance)
rpart.plot(tree, type = 3)
library(scales)
library(kableExtra)
health_insurance %>%
mutate(bmi_30 = ifelse(bmi < 30, "bmi < 30", "bmi >= 30")) %>%
group_by(smoker,bmi_30) %>%
summarise(mean_claims = dollar(mean(charges)),
n = n()) %>%
ungroup() %>%
mutate(percent = round(n/sum(n),2)) %>%
select(-n) %>%
kable("markdown")
tree <- rpart(formula = charges ~  ., data = health_insurance,
control = rpart.control(cp = 0.003))
rpart.plot(tree, type = 3)
tree <- rpart(formula = charges ~  ., data = health_insurance,
control = rpart.control(cp = 0.0001))
cost <- tree$cptable %>%
as_tibble() %>%
select(nsplit, CP, xerror)
cost %>% head()
cost %>%
filter(nsplit > 1) %>%
mutate(min = ifelse(xerror == min(cost$xerror),"y", "n")) %>%
ggplot(aes(nsplit, xerror, color = min)) +
geom_line() +
geom_point() +
theme_bw() +
theme(legend.position = "none") +
scale_color_manual(values = c("black", "red")) +
annotate("text", x = 25, y = 0.17, label = "Minimum Error", color = "red")
pruned_tree <- prune(tree,cp = tree$cptable[which.min(tree$cptable[, "xerror"]), "CP"])
rpart.plot(pruned_tree, type=3)
library(randomForest)
tree <- rpart(charges ~ age + bmi, data = health_insurance)
df <- health_insurance %>% mutate(
prediction = predict(tree, health_insurance))
p1 <- df %>%
ggplot(aes(bmi, age, color = prediction)) +
geom_point() +
scale_color_viridis_c() +
theme_bw() +
labs(title ="Decision Tree") +
theme(legend.position = "none")
rf <- randomForest(charges ~ age + bmi, data = health_insurance, ntree = 50)
df <- health_insurance %>% mutate(
prediction = predict(rf, health_insurance))
p2 <- df %>%
ggplot(aes(bmi, age, color = prediction)) +
geom_point() +
scale_color_viridis_c() +
theme_bw() +
labs(title ="Random Forest") +
theme(legend.position = "none")
library(ggpubr)
ggarrange(p1,p2)
rf_data <- health_insurance %>%
mutate(sex = ifelse(sex == "male", 1, 0),
smoker = ifelse(smoker == "yes", 1, 0),
region_ne = ifelse(region == "northeast", 1,0),
region_nw = ifelse(region == "northwest", 1,0),
region_se = ifelse(region == "southeast", 1,0),
region_sw = ifelse(region == "southwest", 1,0)) %>%
select(-region)
rf_data %>% glimpse(50)
set.seed(42)
index <- createDataPartition(y = rf_data$charges, p = 0.8, list = F)
library(ExamPAData)
library(tidyverse)
library(rpart)
library(rpart.plot)
tree <- rpart(charges ~ smoker + bmi, data = health_insurance)
rpart.plot(tree, type = 3)
library(scales)
library(kableExtra)
health_insurance %>%
mutate(bmi_30 = ifelse(bmi < 30, "bmi < 30", "bmi >= 30")) %>%
group_by(smoker,bmi_30) %>%
summarise(mean_claims = dollar(mean(charges)),
n = n()) %>%
ungroup() %>%
mutate(percent = round(n/sum(n),2)) %>%
select(-n) %>%
kable("markdown")
tree <- rpart(formula = charges ~  ., data = health_insurance,
control = rpart.control(cp = 0.003))
rpart.plot(tree, type = 3)
tree <- rpart(formula = charges ~  ., data = health_insurance,
control = rpart.control(cp = 0.0001))
cost <- tree$cptable %>%
as_tibble() %>%
select(nsplit, CP, xerror)
cost %>% head()
cost %>%
filter(nsplit > 1) %>%
mutate(min = ifelse(xerror == min(cost$xerror),"y", "n")) %>%
ggplot(aes(nsplit, xerror, color = min)) +
geom_line() +
geom_point() +
theme_bw() +
theme(legend.position = "none") +
scale_color_manual(values = c("black", "red")) +
annotate("text", x = 25, y = 0.17, label = "Minimum Error", color = "red")
pruned_tree <- prune(tree,cp = tree$cptable[which.min(tree$cptable[, "xerror"]), "CP"])
rpart.plot(pruned_tree, type=3)
library(randomForest)
tree <- rpart(charges ~ age + bmi, data = health_insurance)
df <- health_insurance %>% mutate(
prediction = predict(tree, health_insurance))
p1 <- df %>%
ggplot(aes(bmi, age, color = prediction)) +
geom_point() +
scale_color_viridis_c() +
theme_bw() +
labs(title ="Decision Tree") +
theme(legend.position = "none")
rf <- randomForest(charges ~ age + bmi, data = health_insurance, ntree = 50)
df <- health_insurance %>% mutate(
prediction = predict(rf, health_insurance))
p2 <- df %>%
ggplot(aes(bmi, age, color = prediction)) +
geom_point() +
scale_color_viridis_c() +
theme_bw() +
labs(title ="Random Forest") +
theme(legend.position = "none")
library(ggpubr)
ggarrange(p1,p2)
rf_data <- health_insurance %>%
mutate(sex = ifelse(sex == "male", 1, 0),
smoker = ifelse(smoker == "yes", 1, 0),
region_ne = ifelse(region == "northeast", 1,0),
region_nw = ifelse(region == "northwest", 1,0),
region_se = ifelse(region == "southeast", 1,0),
region_sw = ifelse(region == "southwest", 1,0)) %>%
select(-region)
rf_data %>% glimpse(50)
set.seed(42)
index <- createDataPartition(y = rf_data$charges, p = 0.8, list = F)
library(caret)
library(ExamPAData)
library(tidyverse)
library(rpart)
library(rpart.plot)
tree <- rpart(charges ~ smoker + bmi, data = health_insurance)
rpart.plot(tree, type = 3)
library(scales)
library(kableExtra)
health_insurance %>%
mutate(bmi_30 = ifelse(bmi < 30, "bmi < 30", "bmi >= 30")) %>%
group_by(smoker,bmi_30) %>%
summarise(mean_claims = dollar(mean(charges)),
n = n()) %>%
ungroup() %>%
mutate(percent = round(n/sum(n),2)) %>%
select(-n) %>%
kable("markdown")
tree <- rpart(formula = charges ~  ., data = health_insurance,
control = rpart.control(cp = 0.003))
rpart.plot(tree, type = 3)
tree <- rpart(formula = charges ~  ., data = health_insurance,
control = rpart.control(cp = 0.0001))
cost <- tree$cptable %>%
as_tibble() %>%
select(nsplit, CP, xerror)
cost %>% head()
cost %>%
filter(nsplit > 1) %>%
mutate(min = ifelse(xerror == min(cost$xerror),"y", "n")) %>%
ggplot(aes(nsplit, xerror, color = min)) +
geom_line() +
geom_point() +
theme_bw() +
theme(legend.position = "none") +
scale_color_manual(values = c("black", "red")) +
annotate("text", x = 25, y = 0.17, label = "Minimum Error", color = "red")
pruned_tree <- prune(tree,cp = tree$cptable[which.min(tree$cptable[, "xerror"]), "CP"])
rpart.plot(pruned_tree, type=3)
library(randomForest)
tree <- rpart(charges ~ age + bmi, data = health_insurance)
df <- health_insurance %>% mutate(
prediction = predict(tree, health_insurance))
p1 <- df %>%
ggplot(aes(bmi, age, color = prediction)) +
geom_point() +
scale_color_viridis_c() +
theme_bw() +
labs(title ="Decision Tree") +
theme(legend.position = "none")
rf <- randomForest(charges ~ age + bmi, data = health_insurance, ntree = 50)
df <- health_insurance %>% mutate(
prediction = predict(rf, health_insurance))
p2 <- df %>%
ggplot(aes(bmi, age, color = prediction)) +
geom_point() +
scale_color_viridis_c() +
theme_bw() +
labs(title ="Random Forest") +
theme(legend.position = "none")
library(ggpubr)
ggarrange(p1,p2)
rf_data <- health_insurance %>%
mutate(sex = ifelse(sex == "male", 1, 0),
smoker = ifelse(smoker == "yes", 1, 0),
region_ne = ifelse(region == "northeast", 1,0),
region_nw = ifelse(region == "northwest", 1,0),
region_se = ifelse(region == "southeast", 1,0),
region_sw = ifelse(region == "southwest", 1,0)) %>%
select(-region)
rf_data %>% glimpse(50)
library(caret)
set.seed(42)
index <- createDataPartition(y = rf_data$charges, p = 0.8, list = F)
train <- rf_data %>% slice(index)
test <- rf_data %>% slice(-index)
rf <- randomForest(charges ~ ., data = train, ntree = 500)
plot(rf)
pred <- predict(rf, test)
get_rmsle <- function(y, y_hat){
sqrt(mean((log(y) - log(y_hat))^2))
}
get_rmsle(test$charges, pred)
get_rmsle(test$charges, mean(train$charges))
varImpPlot(x = rf)
df <- tibble(x1 = c(1,1,2,2), x2 = c(3,4,5,6)) %>%
mutate(f = 2*x1 + 3*x2)
df
df %>% group_by(x1) %>% summarise(f = mean(f))
library(pdp)
bmi <- pdp::partial(rf, pred.var = "bmi") %>% autoplot() + theme_bw()
age <- pdp::partial(rf, pred.var = "age") %>% autoplot() + theme_bw()
ggarrange(bmi, age)
gbm <- gbm(charges ~ ., data = train)
library(gbm)
?`gbm-package`
?gbm
gbm <- gbm(charges ~ ., data = train,
n.trees = 100,
interaction.depth = 2,
n.minobsinnode = 50,
shrinkage = 0.1)
pred <- predict(gbm, test)
pred <- predict(gbm, test, n.trees = 100)
get_rmsle(test$charges, pred)
get_rmsle(test$charges, mean(train$charges))
plot(gbm)
library(gbm)
gbm <- gbm(charges ~ ., data = train,
n.trees = 100,
interaction.depth = 2,
n.minobsinnode = 50,
shrinkage = 0.1)
pred <- predict(gbm, test, n.trees = 100)
get_rmsle(test$charges, pred)
get_rmsle(test$charges, mean(train$charges))
insurance %>%
head()
insurance %>%
mutate(claims_holders_ratio = claims/holders) %>%
ggplot(aes(claims_holders_ratio, age)) +
geom_point()
insurance
term_life
library(ExamPAData)
term_life
termlife
termlife
termlife %>%
mutate(INCOME_AGE_RATIO = INCOME/AGE) %>%
ggplot(INCOME_AGE_RATIO, CHARITY) +
geom_point()
termlife %>%
mutate(INCOME_AGE_RATIO = INCOME/AGE) %>%
ggplot(aes(INCOME_AGE_RATIO, CHARITY)) +
geom_point()
termlife %>%
mutate(INCOME_AGE_RATIO = INCOME/AGE) %>%
ggplot(aes(INCOME_AGE_RATIO, CHARITY)) +
geom_point() +
xlim(0, 1000) +
ylim(0, 1000)
termlife
termlife %>%
mutate(INCOME_AGE_RATIO = INCOME/AGE) %>%
ggplot(aes(INCOME_AGE_RATIO, FACE)) +
geom_point() +
xlim(0, 1000) +
ylim(0, 1000)
termlife %>%
mutate(INCOME_AGE_RATIO = INCOME/AGE) %>%
ggplot(aes(INCOME_AGE_RATIO, FACE)) +
geom_point()
termlife %>%
mutate(INCOME_AGE_RATIO = INCOME/AGE) %>%
ggplot(aes(INCOME_AGE_RATIO, FACE)) +
geom_point() +
xlim(0, 500)
termlife %>%
mutate(INCOME_AGE_RATIO = INCOME/AGE) %>%
ggplot(aes(INCOME_AGE_RATIO, FACE)) +
geom_point() +
xlim(0, 500) +
ylim(0, 100)
termlife %>%
mutate(INCOME_AGE_RATIO = INCOME/AGE) %>%
ggplot(aes(INCOME_AGE_RATIO, FACE)) +
geom_point() +
xlim(0, 500) +
ylim(0, 10)
termlife %>%
mutate(INCOME_AGE_RATIO = INCOME/AGE) %>%
ggplot(aes(INCOME_AGE_RATIO, FACE)) +
geom_point() +
xlim(0, 500) +
ylim(0, 1)
summary(TERM_LI)
summary(termlife)
termlife %>%
filter(FACE > 0) %>%
mutate(INCOME_AGE_RATIO = INCOME/AGE) %>%
ggplot(aes(INCOME_AGE_RATIO, FACE)) +
geom_point()
termlife %>%
filter(FACE > 0) %>%
mutate(INCOME_AGE_RATIO = INCOME/AGE) %>%
ggplot(aes(INCOME_AGE_RATIO, FACE)) +
geom_point() +
theme_bw()
library(bookdown)
publish_book()
